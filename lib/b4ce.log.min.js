B4ce=B4ce||{},B4ce.Log=function(e,t){function n(e){return e.charAt(0).toUpperCase()+e.slice(1)}function i(e,n){var i=e;return"common"===e?function(){var o=Array.prototype.slice.call(arguments,arguments);return i=t.isArray(o[0])||t.isNumber(o[0])?o.shift():[e],this.logMessage(i,n,o)}:function(){var e=Array.prototype.slice.call(arguments,arguments);return this.logMessage([i],n,e)}}var o=function(e){var r,s,l,a,h,c,f={};if(this.sanitizeBrowser(),e=e?t.clone(e):{},this.levels={emerg:8,alert:7,crit:6,err:5,warning:4,notice:3,info:2,debug:1},this.defaultLevel=e.defaultLevel?this.sanitizeLevel(e.defaultLevel):"debug",this.categoryLevel={},this.categories={common:1},e.categories){s=1;for(r in e.categories)e.categories.hasOwnProperty(r)&&(this.categories[r]||(s=2*s,this.categories[r]=s),this.categoryLevel[r]=e.categories[r]?this.sanitizeLevel(e.categories[r]):void 0)}for(r in this.categories)this.categories.hasOwnProperty(r)&&(this.categoryLevel[r]||(this.categoryLevel[r]=this.defaultLevel));e.channels||(e.channels={console:!0,alert:!0});for(r in e.channels)if(e.channels.hasOwnProperty(r))if(s=e.channels[r],s instanceof o.Channel)f[r]=s;else{if(!this.channels[r])throw"Tried to configure invalid default channel: "+r;if(s!==!1){if(c={log:this},t.isObject(s))s.level&&(c.level=this.sanitizeLevel(s.level)),s.categories&&(c.categories=this.sanitizeCategories(s.categories));else if(s!==!0)throw'Invalid config for channel "'+r+'": '+s;f[r]=new this.channels[r](c)}}this.channels=f;for(l in this.categories)if(this.categories.hasOwnProperty(l))for(a in this.levels)this.levels.hasOwnProperty(a)&&(h="common"===l?a:l+n(a),void 0!==this[h]?this.logMessage(this.categories.common,this.levels.info,'Cannot create log method "'+h+'"'):this[h]=i(l,a))};return t.extend(o.prototype,{channels:{},logMessage:function(e,t,n){var i,o,r,s,l,a,h=[];for(e=this.sanitizeCategories(e),t=this.sanitizeLevel(t),o=0,r=e.length;r>o;o+=1)i=e[o],this.levels[t]>=this.levels[this.categoryLevel[i]]&&h.push(i);if(!h.length)return this;for(i in this.channels)this.channels.hasOwnProperty(i)&&(s=this.channels[i],l=!0,a=h,s.filter(h,t,n)&&s.write(h,t,n));return this},setLevel:function(e,t){var n;if(e=e&&""!==e?this.sanitizeLevel(e):void 0,void 0===t){void 0===e?e=this.defaultLevel:this.defaultLevel=e;for(n in this.categoryLevel)this.categoryLevel.hasOwnProperty(n)&&(this.categoryLevel[n]=e)}else{if(!this.categoryLevel.hasOwnProperty(t))throw"Invalid category: "+t;this.categoryLevel[t]=e}return this},sanitizeCategories:function(e){var n,i,o,r=[];if(t.isArray(e)){for(i=0,o=e.length;o>i;i+=1)if(!this.categories.hasOwnProperty(e[i]))throw"Invalid category: "+e[i];r=e.slice()}else{if(!t.isNumber(e))throw"Invalid categories argument: "+e;for(n in this.categories)this.categories.hasOwnProperty(n)&&this.categories[n]&e&&(r.push(n),e-=this.categories[n]);if(e>0)throw"Invalid numeric category value: "+e}return r},sanitizeLevel:function(e){var n;if(t.isString(e)){if(!this.levels.hasOwnProperty(e))throw"Invalid level: "+e;return e}if(t.isNumber(e)){for(n in this.levels)if(this.levels.hasOwnProperty(n)&&e===this.levels[n])return n;throw"Invalid numeric level: "+e}throw"Invalid level: "+e},sanitizeBrowser:function(){Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,i=function(){},o=function(){return n.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,o.prototype=new i,o}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,i;if(null===this)throw new TypeError("this is null or not defined");var o=Object(this),r=o.length>>>0;if("[object Function]"!={}.toString.call(e))throw new TypeError(e+" is not a function");for(t&&(n=t),i=0;r>i;){var s;i in o&&(s=o[i],e.call(n,s,i,o)),i++}}),Function.prototype.bind&&Array.prototype.forEach&&"object"==typeof console&&"object"==typeof console.log&&["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(e){console[e]&&(console[e]=this.bind(console[e],console))},Function.prototype.call)}}),o.Channel=function(e){t.extend(this,e)},t.extend(o.Channel.prototype,{filter:function(e,n){return this.level&&this.log.levels[n]<this.log.levels[this.level]?!1:!(this.categories&&!t.intersect(this.categories,e).length)},prefix:function(e,n){var i=n.toUpperCase();return e=t.without(e,"common"),e.length&&(i+=" ["+e.join(",")+"]"),i+=":"},format:function(e,t,n){return this.prefix(e,t,n)+" "+n.join(" ")},write:function(){throw"Log.Channel.write has to be overriden by actual channel implementation!"}}),o.AlertChannel=function(e){e=t.extend({level:"alert"},e),o.Channel.call(this,e)},t.extend(o.AlertChannel.prototype,o.Channel.prototype,{filter:function(e,t,n){return void 0===window.alert?!1:o.Channel.prototype.filter.call(this,e,t,n)},write:function(e,t,n){window.alert(this.format(e,t,n))}}),o.prototype.channels.alert=o.AlertChannel,o.ConsoleChannel=function(e){o.Channel.call(this,e)},t.extend(o.ConsoleChannel.prototype,o.Channel.prototype,{filter:function(e,t,n){return"object"!=typeof console||"function"!=typeof console.log?!1:o.Channel.prototype.filter.call(this,e,t,n)},format:function(e,t,n){return[this.prefix(e,t,n)].concat(n)},write:function(e,t,n){return console.log.apply(console,this.format(e,t,n)),this}}),o.prototype.channels.console=o.ConsoleChannel,e.Log=o,o}(B4ce,_);